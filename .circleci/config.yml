version: 2
jobs:
    build:
        docker: # See https://docs.docker.com/get-started/#docker-concepts if you are new to Docker.
          - image: circleci/python:3.4
        working_directory: ~/repo
        steps:
          - checkout
          # TODO: Cache gdb install
          - run:
              command: |
                  sudo apt-get install gcc g++ gdb
          - restore_cache:
              keys:
                  - pydeps-{{ .Branch }}-{{ checksum ".circleci/config.yml" }}
          - run:
              # These cannot be installed into a venv: gdb won't see them
              command: |
                  sudo pip3 install pylint ropper retdec-python keystone-engine capstone unicorn
          - save_cache:
              key: pydeps-{{ .Branch }}-{{ checksum ".circleci/config.yml" }}
              paths:
                  - /usr/local/lib/python3.4/site-packages
          - run: make lint
          - run: make test

